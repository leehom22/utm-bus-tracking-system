<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
c
<link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/style/main.css">
  <link rel="stylesheet" href="/style/location.css">
  <link rel="stylesheet" href="/style/feedback.css">
  <link rel="stylesheet" href="/style/news.css">
  <title>Precisely</title>
</head>
<body>
    <div class="top">
      <div class="top-left">
        <div class="web-name">Precisely</div>
        <img class="logo" src="/image/logo.svg" alt="logo">
      </div>
      <div class="top-right">
        <svg class="search-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M11 2C6.03125 2 2 6.03125 2 11C2 15.9688 6.03125 20 11 20C13.2109 20 15.2109 19.2109 16.75 17.9062L20.7188 21.875C21.0938 22.25 21.7188 22.25 22.0938 21.875C22.4688 21.5 22.4688 20.875 22.0938 20.5L18.125 16.5312C19.4062 15 20.1875 13 20.1875 11C20.1875 6.03125 16.1562 2 11 2ZM4 11C4 7.14062 7.14062 4 11 4C14.8594 4 18 7.14062 18 11C18 14.8594 14.8594 18 11 18C7.14062 18 4 14.8594 4 11Z" fill="currentColor"/>
        </svg>     
        <input class="search-bar" type="text" placeholder="Search">
      </div>
    </div>

    <div class="left"> 
      <div class="grid js-dropout-img ">
        <img class="icon" src="/image/bus-icon.svg" alt="Bus">
        <div class="title">Location</div>
      </div>
      <div class="grid js-news-img">
        <img class="icon" src="/image/news-icon.svg" alt="News">
        <div class="title">News</div>
      </div>
      <div class="grid js-feedback-img">
        <img class="icon" src="/image/feedback-icon.svg" alt="Feedback">
        <div class="title">Feedback</div>   
      </div>
    </div>

      <div class="js-dropout-location">
        <!--bus-route will show here-->
      </div>    
    

    <div class="js-news">
      <!--news will show here-->
    </div>

    <div class="js-feedback">
      <!--feedback show here-->
    </div>

    <div id="floating-panel" ></div>

    <div id="map"></div>


</body>
<script type="module" src="/script/main.js"></script>
<script type="module" src="/script/location.js"> </script>
<script type="module" src="/script/news.js"></script>
<script type="module" src="/script/feedback.js"></script>
<script type="module" src="/script/maps.js"></script>

<script 
src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBbZGFRbee76UzQiNFn6cSA0Hcyb7K2uh8" >
</script>

<script>
  
  let slatitude =1.5756014884596912;
  let slongitude =103.61969835550295;
  let elatitude=1.5597053379189187;
  let elongitude=103.6348250402862;
  
  var start=new google.maps.LatLng(slatitude,slongitude)
  var end =new google.maps.LatLng( elatitude,elongitude ) 

  const locations = [{
    title: "K9/K10",
    latitude: slatitude,
    longitude: slongitude
  }, {
    title: "CENTER POINT",
    latitude: elatitude,
    longitude: elongitude
  }];
  
  let map;
  
  async function initMap() { //Direction: Same in different mode
    let position = start;
    const map = new google.maps.Map(document.getElementById("map"), {
    zoom: 18,
    center: position,
    mapId: "DEMO_MAP_ID",
    });
    //Direction API 
    var directionsService = new google.maps.DirectionsService();
    var directionsRenderer = new google.maps.DirectionsRenderer({
      draggable:true,
      map,
    }); //handles display of the polyline and any associated marker Display direction result

    // Request needed library

      const { AdvancedMarkerElement } = await google.maps.importLibrary("marker");
    directionsRenderer.setMap(map); //Bind with map 

  
    locations.forEach((location) => {
      // The marker position at the location
      position = { lat: location.latitude, lng: location.longitude };
  
      let marker = new AdvancedMarkerElement({
        map: map,
        position: position,
        title: location.title,
      });
      console.log(position);
    });
    calculateAndDisplayRoute(directionsService, directionsRenderer);

    /*
    calcRoute(directionsService,directionsRenderer,centerPoint,KTRK01)
    */
  }
  
  
function calculateAndDisplayRoute(directionsService, directionsRenderer) {
//calculate distance and show polyline 

  const waypts = [];
  const checkboxArray =
[
{lat:1.5755369107882171,  lng:103.61978198903313}, 
{lat:1.5738869823327488, lng:103.62008161447446},
{lat:1.574105619212791, lng:103.62035392737016},
{lat:1.5592650893575812, lng:103.63492441361308},
{lat:1.5575301665271604, lng:103.6369383058712},//
{lat:1.5626960658379052, lng:103.63902605006561},
{lat:1.5587234616453303, lng:103.64051450548558 },
{lat:1.5543378933405396, lng:103.64317898913},
{lat:1.56345827426988, lng:103.65329441049309},
{lat:1.5645563622408707, lng:103.65255143466082},
{lat:1.5564975497000193, lng:103.64900532694843},
{lat:1.5576309210728447, lng:103.64591305477848},
{lat:1.5565735668061826, lng:103.6425405931917},
];

  for (let i = 0; i < checkboxArray.length; i++) {
      waypts.push({
        location: checkboxArray[i],
        stopover: false,
      });
    
  }

  directionsService
    .route({
      origin: start,
      destination: end,
      waypoints: waypts,
      optimizeWaypoints: false,
      travelMode: google.maps.TravelMode.DRIVING,
    })
    .then((response) => {
      directionsRenderer.setDirections(response);

      const route = response.routes[0];
      const summaryPanel = '';

      summaryPanel.innerHTML = "";

      // For each route, display summary information.
      for (let i = 0; i < route.legs.length; i++) {
        const routeSegment = i + 1;

        summaryPanel.innerHTML +=
          "<b>Route Segment: " + routeSegment + "</b><br>";
        summaryPanel.innerHTML += route.legs[i].start_address + " to ";
        summaryPanel.innerHTML += route.legs[i].end_address + "<br>";
        summaryPanel.innerHTML += route.legs[i].distance.text + "<br><br>";
      }
    })
    .catch((e) => window.alert("Directions request failed due to " + status));
}
  /*
    //Direction API to calculate and show route 
  function calcRoute(directionsService,directionsRenderer,origin,destination,){
    var request={
      origin: origin,
      destination:destination,
      travelMode:'DRIVING'
    };
    directionsService.route(request,function(result,status){
      if(status=='OK'){
        directionsRenderer.setDirections(result);
      }
    })
  }
  console.log(calcRoute)
  */

  initMap();





</script>
</html>